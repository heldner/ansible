---
- name: Install neovim
  ansible.builtin.package:
    state: present
    name: neovim
  become: true

- name: Create home dir
  ansible.builtin.file:
    state: directory
    path: "{{ neovim_home }}"

- name: Create dirs
  ansible.builtin.file:
    state: directory
    path: "{{ neovim_home }}/{{ item }}"
  loop:
    - autoload
    - colors
    - plugged

- name: Copy init.vim rc
  ansible.builtin.template:
    src: init.vim.j2
    dest: "{{ neovim_home }}/init.vim"
  register: _init_vim

- name: Fetch plug.vim
  ansible.builtin.uri:
    url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    dest: "{{ neovim_home }}/autoload/plug.vim"
    creates: "{{ neovim_home }}/autoload/plug.vim"

- name: Install plugins
  ansible.builtin.shell:
    cmd: nvim -c 'PlugInstall' -c quit -c quit
  when: _init_vim.changed

- name: Create jelybeans link
  ansible.builtin.file:
    state: link
    dest: "{{ neovim_home }}/colors/jellybeans.vim"
    src: "{{ neovim_home }}/plugged/jellybeans.vim/colors/jellybeans.vim"

- name: Install python support
  ansible.builtin.pip:
    name: pynvim
  become: true
