---
- name: Install X packages
  ansible.builtin.package:
    state: present
    name:
      - abiword
      - baobab
      - dbus-x11
      - feh
      - ffmpeg
      - flameshot
      - gimp
      - gnome-keyring
      - gnome-themes-extra-data
      - gsfonts-x11
      - gtk-chtheme
      - imagemagick
      - inotify-tools
      - libpam-gnome-keyring
      - libreoffice-calc
      - libreoffice-impress
      - libreoffice-writer
      - pinentry-curses
      - rxvt-unicode
      - rxvt-unicode-256color
      - sxhkd
      - unclutter
      - unclutter-startup
      - x11-xkb-utils
      - x11-xserver-utils
      - xautolock
      - xclip
      - xdotool
      - xfonts-terminus
      - xinit
      - xinput
      - xserver-xorg
      - xserver-xorg-input-all
      - xserver-xorg-legacy
      - xserver-xorg-video-fbdev
      - xserver-xorg-video-intel
      - xserver-xorg-video-vesa
      - zathura
  tags: xorg
  become: true

- name: Install slim
  ansible.builtin.include_tasks: slim.yml
  tags: slim

- name: Copy keyboard defaults
  template:
    src: etc_default_keyboard.j2
    dest: /etc/default/keyboard
    mode: 0644
  notify: reload udev input
  tags: [xorg, keyboard]
  become: true

- name: Sync fonts dir
  ansible.builtin.synchronize:
    archive: false
    src: fonts/
    dest: '{{ ansible_user_dir }}/.local/share/fonts'
    recursive: true
    rsync_opts: ["--times"]
    use_ssh_args: true
  tags: xorg

- name: Create fonts.dir
  ansible.builtin.shell:
    cmd: /usr/sbin/update-fonts-dir '{{ ansible_user_dir }}/.local/share/fonts'
    creates: '{{ ansible_user_dir }}/.local/share/fonts/fonts.dir'
  tags: xorg

- name: Create uuids
  ansible.builtin.shell:
    cmd: /usr/bin/fc-cache -f
    creates: '{{ ansible_user_dir }}/.local/share/fonts/.uuid'
  tags: xorg

- name: Copy session scripts
  ansible.builtin.copy:
    src: '{{ item }}'
    dest: '{{ ansible_user_dir }}/.{{ item }}'
    mode: 0644
  loop:
    - gtkrc-2.0
    - xsession
    - xsessionrc
    - Xresources
  tags:
    - xorg
    - script
